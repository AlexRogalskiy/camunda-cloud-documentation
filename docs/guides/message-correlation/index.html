<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Camunda Cloud Docs Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Camunda Cloud Docs Blog Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="Camunda Cloud Docs" href="/opensearch.xml">

    <script>!function(e,t,a,n,g){e[n]=e[n]||[],e[n].push({"gtm.start":(new Date).getTime(),event:"gtm.js"});var m=t.getElementsByTagName(a)[0],r=t.createElement(a);r.async=!0,r.src="https://www.googletagmanager.com/gtm.js?id=GTM-KQGNSTS",m.parentNode.insertBefore(r,m)}(window,document,"script","dataLayer")</script>
    <title data-react-helmet="true">Message Correlation | Camunda Cloud Docs</title><meta data-react-helmet="true" property="og:url" content="https://docs.camunda.io/docs/guides/message-correlation/"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Message Correlation | Camunda Cloud Docs"><meta data-react-helmet="true" name="description" content="Message correlation is a powerful feature in Camunda Cloud. It allows you to target a running workflow with a state update from an external system asynchronously."><meta data-react-helmet="true" property="og:description" content="Message correlation is a powerful feature in Camunda Cloud. It allows you to target a running workflow with a state update from an external system asynchronously."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://docs.camunda.io/docs/guides/message-correlation/"><link data-react-helmet="true" rel="alternate" href="https://docs.camunda.io/docs/guides/message-correlation/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://docs.camunda.io/docs/guides/message-correlation/" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><script data-react-helmet="true" src="https://cmp.osano.com/16CVvwSNKHi9t1grQ/2ce963c0-31c9-4b54-b052-d66a2a948ccc/osano.js"></script><link rel="stylesheet" href="/assets/css/styles.9d4cb350.css">
<link rel="preload" href="/assets/js/runtime~main.c8bde3bd.js" as="script">
<link rel="preload" href="/assets/js/main.8d1e63d5.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/camunda-cloud-gradient.png" alt="Camunda Cloud Docs" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/camunda-cloud-gradient.png" alt="Camunda Cloud Docs" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Camunda Cloud Docs</b></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/guides/">latest</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/guides/message-correlation/">latest</a></li><li><a class="dropdown__link" href="/docs/1.1/guides/message-correlation/">1.1</a></li><li><a class="dropdown__link" href="/docs/1.0/guides/">1.0</a></li><li><a class="dropdown__link" href="/docs/0.26/guides/">0.26</a></li><li><a class="dropdown__link" href="/docs/0.25/guides/">0.25</a></li></ul></div><a class="navbar__item navbar__link navbar__link--active" href="/docs/guides/">Guides</a><a class="navbar__item navbar__link" href="/docs/components/">Components</a><a class="navbar__item navbar__link" href="/docs/reference/">Reference</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_1Doo"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/camunda-cloud-gradient.png" alt="Camunda Cloud Docs" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/camunda-cloud-gradient.png" alt="Camunda Cloud Docs" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Camunda Cloud Docs</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a role="button" class="menu__link menu__link--sublist">Versions</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/guides/message-correlation/">latest</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/1.1/guides/message-correlation/">1.1</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/1.0/guides/">1.0</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.26/guides/">0.26</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/0.25/guides/">0.25</a></li></ul></li><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/guides/">Guides</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/components/">Components</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/reference/">Reference</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu menu--responsive thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA" aria-label="Sidebar navigation"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/guides/">Introduction to Camunda Cloud</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Getting started with Camunda Cloud</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/getting-started/">Sign up &amp; log in</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/getting-started/setup-client-connection-credentials/">Setup client connection credentials</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/getting-started/connect-to-your-cluster/">Connect to your cluster</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/getting-started/model-your-first-process/">Model your first process</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/getting-started/deploy-your-process-and-start-process-instance/">Deploy and start your process instance</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/getting-started/implement-service-task/">Implement a service task</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/getting-started/implement-decision-gateway/">Implement a decision gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/getting-started/monitor-your-process-in-operate/">Monitor your process in Operate</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/guides/setting-up-development-project/">Setting up your first development project</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/docs/guides/message-correlation/">Message Correlation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Update Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/update-guide/introduction/">Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/update-guide/026-to-100/">Update 0.26 to 1.0</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/update-guide/100-to-110/">Update 1.0 to 1.1</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/guides/update-guide/110-to-120/">Update 1.1 to 1.2</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/guides/migrating-from-Camunda-Platform/">Migrating from Camunda Platform</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><span class="badge badge--secondary">Version: latest</span><div class="markdown"><header><h1 class="h1Heading_27L5">Message Correlation</h1></header><p>Message correlation is a powerful feature in Camunda Cloud. It allows you to target a running workflow with a state update from an external system asynchronously. </p><p>This tutorial uses the <a href="https://github.com/camunda-community-hub/zeebe-client-node-js" target="_blank" rel="noopener noreferrer">Node.js client</a>, but it serves to illustrate message correlation concepts that are applicable to all language clients.</p><p>We will use <a href="https://github.com/camunda-community-hub/zeebe-simple-monitor" target="_blank" rel="noopener noreferrer">Simple Monitor</a> to inspect the running workflow state. Simple Monitor is a community-supported tool, and is not designed to be used in production. However, it is useful during development.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="workflow"></a>Workflow<a class="hash-link" href="#workflow" title="Direct link to heading">#</a></h2><p>Here is a basic example from <a href="https://docs.camunda.io/docs/product-manuals/concepts/messages" target="_blank" rel="noopener noreferrer">the Camunda Cloud documentation</a>:</p><p><img alt="message correlation workflow" src="/assets/images/message-correlation-workflow-f6fbfaca3e4d0b6de462f00562a4919e.png"></p><p>Use <a href="https://camunda.com/download/modeler/" target="_blank" rel="noopener noreferrer">Camunda Modeler</a> to open the <a href="https://github.com/jwulf/zeebe-message-correlation/bpmn/test-messaging.bpmn" target="_blank" rel="noopener noreferrer">test-messaging</a> file in <a href="https://github.com/jwulf/zeebe-message-correlation" target="_blank" rel="noopener noreferrer">this GitHub project</a>.</p><p>Click on the intermediate message catch event to see how it is configured:</p><p><img alt="message properties" src="/assets/images/message-correlation-message-properties-627243cb9e694064db03f530ef5ac438.png"></p><p>A crucial piece here is the <strong>Subscription Correlation Key</strong>. In a running instance of this workflow, an incoming <strong>Money Collected</strong> message will have a <code>correlationKey</code> property:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  zbc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">publishMessage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    correlationKey</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;345&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Money Collected&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    variables</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      paymentStatus</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;paid&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p> The concrete value of the message <code>correlationKey</code> is matched against running workflow instances by comparing the supplied value against the <code>orderId</code> variable of running instances subscribed to this message. This is the relationship established by setting the <code>correlationKey</code> to <code>orderId</code> in the message catch event in the BPMN.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="running-the-demonstration"></a>Running the demonstration<a class="hash-link" href="#running-the-demonstration" title="Direct link to heading">#</a></h2><p>To run the demonstration, take the following steps:</p><ol><li><p>Clone this repository.</p></li><li><p>Install dependencies:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">npm i &amp;&amp; npm i -g ts-node typescript</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li><p>In another terminal, start the Zeebe Broker using the <code>simple-monitor</code> profile from the <a href="https://github.com/camunda-community-hub/zeebe-docker-compose" target="_blank" rel="noopener noreferrer">zeebe-docker-compose</a> repo.</p></li><li><p>Deploy the workflow and start an instance:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ts-node start-workflow.ts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li></ol><p>This starts a workflow instance with the <code>orderId</code> set to 345:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">await</span><span class="token plain"> zbc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">createProcessInstance</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;test-messaging&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     orderId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;345&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     customerId</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;110110&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     paymentStatus</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;unpaid&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="5"><li><p>Open Simple Monitor at <a href="http://localhost:8082" target="_blank" rel="noopener noreferrer">http://localhost:8082</a>.</p></li><li><p>Click on the workflow instance. You will see the current state of the workflow:</p><p><img alt="workflow state" src="/assets/images/message-correlation-workflow-state-a8ddda300727d18af1fd935f653437b0.png"></p></li></ol><p>The numbers above the BPMN symbols indicate that no tokens are waiting at the start event, and one has passed through. One token is waiting at the <strong>Collect Money</strong> task, and none have passed through.</p><ol start="7"><li>Take a look at the <strong>Variables</strong> tab at the bottom of the screen. (If you don&#x27;t see it, you are probably looking at the workflow, rather than the instance. In that case, drill down into the instance):</li></ol><p><img alt="message correlation variables" src="/assets/images/message-correlation-variables-41a1f106658660fc54a577f933e1b21c.png"></p><p>You can see that this workflow instance has the variable <code>orderId</code> set to the value 345.</p><ol start="8"><li>Start the workers:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ts-node workers.ts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="9"><li>Refresh Simple Monitor to see the current state of the workflow:</li></ol><p><img alt="message correlation wait on message" src="/assets/images/message-correlation-wait-on-message-a529ffc5669daa071820eba0ceb1bdd7.png"></p><p>Now, the token is at the message catch event, waiting for a message to be correlated.</p><ol start="10"><li>Take a look at the <strong>Message Subscriptions</strong> tab:</li></ol><p><img alt="message subscriptions" src="/assets/images/message-correlation-message-subscriptions-c9d7715f731f55726fef33087c70226d.png"></p><p>You can see the broker has opened a message subscription for this workflow instance with the concrete value of the <code>orderId</code> 345. This was created when the token entered the message catch event.</p><ol start="11"><li>Send the message in another terminal:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ts-node send-message.ts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="12"><li>Refresh Simple Monitor, and note that the message has been correlated and the workflow has run to completion:</li></ol><p><img alt="message correlation completed" src="/assets/images/message-correlation-completed-6bc7fc438ddf1e7ba20d186ed1a5c426.png"></p><p>The <strong>Message Subscriptions</strong> tab now reports that the message was correlated:</p><p><img alt="message correlation correlated" src="/assets/images/message-correlation-correlated-b322945cb6db77827a0327d8855ffb82.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="message-buffering"></a>Message buffering<a class="hash-link" href="#message-buffering" title="Direct link to heading">#</a></h2><p>Messages are buffered on the broker, so your external systems can emit messages before your process arrives at the catch event. The amount of time a message is buffered is configured when publishing the message from the client library.</p><p>For example, to send a message buffered for 10 minutes with the JavaScript client:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  zbc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">publishMessage</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    correlationKey</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;345&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Money Collected&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    variables</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      paymentStatus</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;paid&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    timeToLive</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">600000</span><span class="token plain"></span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>To see it in action, take the following steps:</p><ol><li>Keep the workers running.</li><li>Publish the message:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ts</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">node send</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">ts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li>Click on <strong>Messages</strong> at the top of the Simple Monitor page. You will see the message buffered on the broker:</li></ol><p><img src="/assets/images/message-correlation-buffered-b207382072f58402f413dcd4f301813f.png"></p><ol start="4"><li>Start another instance of the workflow:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly typescript"><pre tabindex="0" class="prism-code language-typescript codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ts</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">node start</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">workflow</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">ts</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note that the message is correlated to the workflow instance, even though it arrived before the workflow instance was started.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="common-mistakes"></a>Common mistakes<a class="hash-link" href="#common-mistakes" title="Direct link to heading">#</a></h2><p>A couple of common gotchas:</p><ul><li><p>The <code>correlationKey</code> in the BPMN message definition is the name of the workflow variable to match against. The <code>correlationKey</code> in the message is the concrete value to match against that variable in the workflow instance. </p></li><li><p>The message subscription <em>is not updated after it is opened</em>. That is not an issue in the case of a message catch event. However, for boundary message events (both interrupting and non-interrupting,) the subscription is opened <em>as soon as the token enters the bounding subprocess</em>. If any service task modifies the <code>orderId</code> value inside the subprocess, the subscription is not updated.  </p><p>For example, the interrupting boundary message event in the following example will not be correlated on the updated value, because the subscription is opened when the token enters the subprocess, using the value at that time:</p><p><img alt="not correlating" src="/assets/images/message-correlation-not-like-this-717eb904455937761500156655379fda.png"></p><p>If you need a boundary message event correlated on a value modified somewhere in your process, put the boundary message event in a subprocess after the task that sets the variable. The message subscription for the boundary message event will open when the token enters the subprocess, with the current variable value.</p><p><img alt="correlating" src="/assets/images/message-correlation-like-this-88097160962111ea7249bcc608347b5d.png"></p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="summary"></a>Summary<a class="hash-link" href="#summary" title="Direct link to heading">#</a></h2><p>Message Correlation is a powerful feature in Camunda Cloud. Knowing how messages are correlated, and how and when the message subscription is created is important to design systems that perform as expected.</p><p>Simple Monitor is a useful tool for inspecting the behavior of a local Camunda Cloud system to figure out what is happening during development.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><a href="https://github.com/camunda-cloud/camunda-cloud-documentation/edit/master/docs/guides/message-correlation.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_3DPF"></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/guides/setting-up-development-project/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Setting up your first development project</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/guides/update-guide/introduction/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Introduction »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#workflow" class="table-of-contents__link">Workflow</a></li><li><a href="#running-the-demonstration" class="table-of-contents__link">Running the demonstration</a></li><li><a href="#message-buffering" class="table-of-contents__link">Message buffering</a></li><li><a href="#common-mistakes" class="table-of-contents__link">Common mistakes</a></li><li><a href="#summary" class="table-of-contents__link">Summary</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/guides/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/licenses/">Licenses</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/notices/">Notices</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/release-policy/">Release cycle</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://zeebe-slack-invite.herokuapp.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack</a></li><li class="footer__item"><a href="https://twitter.com/camunda" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://github.com/camunda-cloud/camunda-cloud-documentation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://camunda.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cloud Console</a></li><li class="footer__item"><a href="https://status.camunda.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status</a></li><li class="footer__item"><a class="footer__link-item" href="/contact/">Contact</a></li><li class="footer__item"><a href="https://camunda.com/blog/category/camunda-cloud/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://camunda.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy Statement</a></li><li class="footer__item"><a class="osano-footer-link-docu" href="#" onclick='Osano.cm.showDrawer("osano-cm-dom-info-dialog-open")'>Cookie Preferences</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://camunda.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_qW4Z"><img class="footer__logo" alt="Camunda.com" src="/img/logo-light.svg"></a></div><div>Copyright © 2021 Camunda</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c8bde3bd.js"></script>
<script src="/assets/js/main.8d1e63d5.js"></script>

    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KQGNSTS" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    </body>
</html>