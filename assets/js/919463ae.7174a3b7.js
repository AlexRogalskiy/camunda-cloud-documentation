(self.webpackChunkcamunda_cloud_documentation=self.webpackChunkcamunda_cloud_documentation||[]).push([[89132],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return p},kt:function(){return d}});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),u=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},h=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=u(n),d=a,m=h["".concat(l,".").concat(d)]||h[d]||c[d]||o;return n?r.createElement(m,i(i({ref:t},p),{},{components:n})):r.createElement(m,i({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}h.displayName="MDXCreateElement"},80473:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return l},toc:function(){return u},default:function(){return c}});var r=n(22122),a=n(19756),o=(n(67294),n(3905)),i={id:"health",title:"Health status",description:"This document analyzes health status checks and responses."},s=void 0,l={unversionedId:"components/zeebe/deployment-guide/operations/health",id:"components/zeebe/deployment-guide/operations/health",isDocsHomePage:!1,title:"Health status",description:"This document analyzes health status checks and responses.",source:"@site/docs/components/zeebe/deployment-guide/operations/health.md",sourceDirName:"components/zeebe/deployment-guide/operations",slug:"/components/zeebe/deployment-guide/operations/health",permalink:"/docs/components/zeebe/deployment-guide/operations/health",editUrl:"https://github.com/camunda-cloud/camunda-cloud-documentation/edit/master/docs/components/zeebe/deployment-guide/operations/health.md",version:"current",frontMatter:{id:"health",title:"Health status",description:"This document analyzes health status checks and responses."},sidebar:"Components",previous:{title:"Metrics",permalink:"/docs/components/zeebe/deployment-guide/operations/metrics"},next:{title:"Backpressure",permalink:"/docs/components/zeebe/deployment-guide/operations/backpressure"}},u=[{value:"Broker",id:"broker",children:[{value:"Startup check",id:"startup-check",children:[]},{value:"Ready check",id:"ready-check",children:[]},{value:"Health check",id:"health-check",children:[]}]},{value:"Gateway",id:"gateway",children:[{value:"Health status",id:"health-status",children:[]},{value:"Startup probe",id:"startup-probe",children:[]},{value:"Liveness probe",id:"liveness-probe",children:[]},{value:"Status responses",id:"status-responses",children:[]},{value:"Customization",id:"customization",children:[]}]}],p={toc:u};function c(e){var t=e.components,n=(0,a.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"broker"},"Broker"),(0,o.kt)("p",null,"Zeebe broker exposes two http endpoints to query its health status:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Startup check"),(0,o.kt)("li",{parentName:"ul"},"Ready check"),(0,o.kt)("li",{parentName:"ul"},"Health check")),(0,o.kt)("h3",{id:"startup-check"},"Startup check"),(0,o.kt)("p",null,"Startup check endpoint is exposed via ",(0,o.kt)("inlineCode",{parentName:"p"},"http://{zeebe-broker}:{zeebe.broker.network.monitoringApi.port}/startup")," (by default port 9600).\nThis endpoint returns an empty 204 response. If it is not ready, it will return a 503 error."),(0,o.kt)("p",null,"A broker has successfully started when:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"The broker has found other brokers in the cluster."),(0,o.kt)("li",{parentName:"ol"},"All partitions owned by this broker have started and participate in replication."),(0,o.kt)("li",{parentName:"ol"},"Other necessary services have started.")),(0,o.kt)("p",null,"A successful startup does not mean the broker is ready to process requests.\nThe broker is ready only after startup has successfully completed."),(0,o.kt)("h3",{id:"ready-check"},"Ready check"),(0,o.kt)("p",null,"Ready check endpoint is exposed via ",(0,o.kt)("inlineCode",{parentName:"p"},"http://{zeebe-broker}:{zeebe.broker.network.monitoringApi.port}/ready")," (by default port 9600).\nThis endpoint returns an empty 204 response. If it is not ready, it will return a 503 error."),(0,o.kt)("p",null,"A broker is ready when it installs all necessary services to start processing in all partitions.\nIf a broker is ready, it doesn't mean it's the leader for the partitions.\nIt means it is participating in the replication and can be either a leader or a follower of all the partitions that are assigned to it.\nOnce it is ready, it never becomes unready again."),(0,o.kt)("p",null,"A ready check is useful, for example, to use as a ",(0,o.kt)("inlineCode",{parentName:"p"},"readinessProbe")," in a Kubernetes configuration to control when a pod can be restarted for rolling upgrade.\nDepending on the cluster configuration, restarting one pod before the previous one is ready might make the system unavailable because the quorum of replicas is not available.\nBy configuring a ",(0,o.kt)("inlineCode",{parentName:"p"},"readinessProbe")," that uses the ready check endpoint, we can inform Kubernetes when it is safe to proceed with the rolling update."),(0,o.kt)("h3",{id:"health-check"},"Health check"),(0,o.kt)("p",null,"Health check endpoint is exposed via ",(0,o.kt)("inlineCode",{parentName:"p"},"http://{zeebe-broker}:{zeebe.broker.network.monitoringApi.port}/health")," (by default port 9600).\nThis endpoint returns an empty 204 response if the broker is healthy. If it is not healthy, it will return a 503 error.\nA broker is never healthy before it is ready.\nUnlike ready check, a broker can become unhealthy after it is healthy.\nHence, it gives a better status of a running broker."),(0,o.kt)("p",null,"A broker is healthy when it can process processes, accept commands, and perform all its expected tasks.\nIf it is unhealthy, it may mean three things:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"It is only temporarily unhealthy"),": For example, due to environmental circumstances such as temporary I/O issues."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"It is partially unhealthy"),": One or more partitions could be unhealthy, while the rest of them are able to process processes."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"It is completely dead"))),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"/docs/components/zeebe/deployment-guide/operations/metrics"},"Metrics")," give more insight into which partition is healthy or unhealthy.\nWhen a broker becomes unhealthy, it's recommended to check the logs to see what went wrong."),(0,o.kt)("h2",{id:"gateway"},"Gateway"),(0,o.kt)("p",null,"Zeebe gateway exposes three HTTP endpoints to query its health status:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Health status - ",(0,o.kt)("inlineCode",{parentName:"li"},"http://{zeebe-gateway}:9600/health")),(0,o.kt)("li",{parentName:"ul"},"Startup probe - ",(0,o.kt)("inlineCode",{parentName:"li"},"http://{zeebe-gateway}:9600/actuator/health/startup")),(0,o.kt)("li",{parentName:"ul"},"Liveness probe - ",(0,o.kt)("inlineCode",{parentName:"li"},"http://{zeebe-gateway}:9600/actuator/health/liveness"))),(0,o.kt)("p",null,"(The default port can be changed in the configuration: ",(0,o.kt)("inlineCode",{parentName:"p"},"{zeebe.gateway.monitoring.port}"),")"),(0,o.kt)("h3",{id:"health-status"},"Health status"),(0,o.kt)("p",null,"The gateway is healthy if it:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Started successfully"),(0,o.kt)("li",{parentName:"ul"},"Has sufficient free memory and disk space to work with"),(0,o.kt)("li",{parentName:"ul"},"Is able to respond to requests within a defined timeout"),(0,o.kt)("li",{parentName:"ul"},"Is aware of other nodes in the cluster"),(0,o.kt)("li",{parentName:"ul"},"Is aware of leaders for partitions")),(0,o.kt)("h3",{id:"startup-probe"},"Startup probe"),(0,o.kt)("p",null,"The gateway starts if it finished its boot sequence successfully and is ready to receive requests. It no longer starts when it initiates the shutdown sequence."),(0,o.kt)("p",null,"The started probe can be used as Kubernetes startup probe."),(0,o.kt)("h3",{id:"liveness-probe"},"Liveness probe"),(0,o.kt)("p",null,"The gateway is live if it:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Started successfully"),(0,o.kt)("li",{parentName:"ul"},"Has a minimal amount of free memory and disk space to work with"),(0,o.kt)("li",{parentName:"ul"},"Is able to respond to requests within a defined timeout, or misses the timeout for less than 10 minutes"),(0,o.kt)("li",{parentName:"ul"},"Is aware of other nodes in the cluster, or lost awareness of other nodes for less than five minutes"),(0,o.kt)("li",{parentName:"ul"},"Is aware of leaders for partitions, or lost awareness of partition leaders for less than five minutes")),(0,o.kt)("p",null,"The liveness probe can be used as Kubernetes liveness probe."),(0,o.kt)("h3",{id:"status-responses"},"Status responses"),(0,o.kt)("p",null,"Each endpoint returns a status which can be one of the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"UNKNWON")," (HTTP status code 200)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"UP")," (HTTP status code 200)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"DOWN")," (HTTP status code 503)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"OUT_OF_SERVICE")," (HTTP status code 503)")),(0,o.kt)("p",null,"If details are enabled (default), the response will also contain additional details."),(0,o.kt)("h3",{id:"customization"},"Customization"),(0,o.kt)("p",null,"Health indicators are set to sensible defaults. For specific use cases, it might be necessary to ",(0,o.kt)("a",{parentName:"p",href:"/docs/components/zeebe/deployment-guide/configuration/gateway-health-probes"},"customize health indicators"),"."))}c.isMDXComponent=!0}}]);