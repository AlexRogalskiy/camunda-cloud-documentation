(self.webpackChunkcamunda_cloud_documentation=self.webpackChunkcamunda_cloud_documentation||[]).push([[2460],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return c},kt:function(){return h}});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),d=u(n),h=i,m=d["".concat(s,".").concat(h)]||d[h]||p[h]||o;return n?r.createElement(m,a(a({ref:t},c),{},{components:n})):r.createElement(m,a({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,a[1]=l;for(var u=2;u<o;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},80262:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return a},metadata:function(){return l},toc:function(){return s},default:function(){return c}});var r=n(22122),i=n(19756),o=(n(67294),n(3905)),a={id:"setting-up-a-cluster",title:"Setting up a Zeebe Cluster"},l={unversionedId:"product-manuals/zeebe/operations/setting-up-a-cluster",id:"version-0.25/product-manuals/zeebe/operations/setting-up-a-cluster",isDocsHomePage:!1,title:"Setting up a Zeebe Cluster",description:"To set up a cluster you need to adjust the cluster section",source:"@site/versioned_docs/version-0.25/product-manuals/zeebe/operations/setting-up-a-cluster.md",sourceDirName:"product-manuals/zeebe/operations",slug:"/product-manuals/zeebe/operations/setting-up-a-cluster",permalink:"/docs/0.25/product-manuals/zeebe/operations/setting-up-a-cluster",editUrl:"https://github.com/camunda-cloud/camunda-cloud-documentation/edit/master/versioned_docs/version-0.25/product-manuals/zeebe/operations/setting-up-a-cluster.md",version:"0.25",frontMatter:{id:"setting-up-a-cluster",title:"Setting up a Zeebe Cluster"},sidebar:"version-0.25/Product Manuals",previous:{title:"Network Ports",permalink:"/docs/0.25/product-manuals/zeebe/operations/network-ports"},next:{title:"Metrics",permalink:"/docs/0.25/product-manuals/zeebe/operations/metrics"}},s=[{value:"Configuration",id:"configuration",children:[]},{value:"Partitions bootstrapping",id:"partitions-bootstrapping",children:[]},{value:"Keep Alive Intervals",id:"keep-alive-intervals",children:[]}],u={toc:s};function c(e){var t=e.components,a=(0,i.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,r.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"To set up a cluster you need to adjust the ",(0,o.kt)("inlineCode",{parentName:"p"},"cluster")," section\nin the Zeebe configuration file. Below is a snippet\nof the default Zeebe configuration file, it should be self-explanatory."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"...\n    cluster:\n      # This section contains all cluster related configurations, to setup a zeebe cluster\n\n      # Specifies the unique id of this broker node in a cluster.\n      # The id should be between 0 and number of nodes in the cluster (exclusive).\n      #\n      # This setting can also be overridden using the environment variable ZEEBE_BROKER_CLUSTER_NODEID.\n      nodeId: 0\n\n      # Controls the number of partitions, which should exist in the cluster.\n      #\n      # This can also be overridden using the environment variable ZEEBE_BROKER_CLUSTER_PARTITIONSCOUNT.\n      partitionsCount: 1\n\n      # Controls the replication factor, which defines the count of replicas per partition.\n      # The replication factor cannot be greater than the number of nodes in the cluster.\n      #\n      # This can also be overridden using the environment variable ZEEBE_BROKER_CLUSTER_REPLICATIONFACTOR.\n      replicationFactor: 1\n\n      # Specifies the zeebe cluster size. This value is used to determine which broker\n      # is responsible for which partition.\n      #\n      # This can also be overridden using the environment variable ZEEBE_BROKER_CLUSTER_CLUSTERSIZE.\n      clusterSize: 1\n\n      # Allows to specify a list of known other nodes to connect to on startup\n      # The contact points of the internal network configuration must be specified.\n      # The format is [HOST:PORT]\n      # Example:\n      # initialContactPoints : [ 192.168.1.22:26502, 192.168.1.32:26502 ]\n      #\n      # To guarantee the cluster can survive network partitions, all nodes must be specified\n      # as initial contact points.\n      #\n      # This setting can also be overridden using the environment variable ZEEBE_BROKER_CLUSTER_INITIALCONTACTPOINTS\n      # specifying a comma-separated list of contact points.\n      # Default is empty list:\n      initialContactPoints: []\n\n      # Allows to specify a name for the cluster\n      # This setting can also be overridden using the environment variable ZEEBE_BROKER_CLUSTER_CLUSTERNAME.\n      # Example:\n      clusterName: zeebe-cluster\n")),(0,o.kt)("h1",{id:"example"},"Example"),(0,o.kt)("p",null,"In this example, we will set up a Zeebe cluster with\nfive brokers. Each broker needs to get a unique node id.\nTo scale well, we will bootstrap five partitions\nwith a replication factor of three. For more information about this,\nplease take a look into the ",(0,o.kt)("a",{parentName:"p",href:"/docs/0.25/product-manuals/zeebe/basics/clustering"},"Clustering")," section."),(0,o.kt)("p",null,"The clustering setup will look like this:"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"cluster",src:n(5026).Z})),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("p",null,"The configuration of the first broker could look like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"...\n  cluster:\n    nodeId: 0\n    partitionsCount: 5\n    replicationFactor: 3\n    clusterSize: 5\n    initialContactPoints: [\n      ADDRESS_AND_PORT_OF_NODE_0,\n      ADDRESS_AND_PORT_OF_NODE_1,\n      ADDRESS_AND_PORT_OF_NODE_2,\n      ADDRESS_AND_PORT_OF_NODE_3,\n      ADDRESS_AND_PORT_OF_NODE_4\n    ]\n")),(0,o.kt)("p",null,"For the other brokers the configuration will slightly change."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"...\n  cluster:\n    nodeId: NODE_ID\n    partitionsCount: 5\n    replicationFactor: 3\n    clusterSize: 5\n    initialContactPoints: [\n      ADDRESS_AND_PORT_OF_NODE_0,\n      ADDRESS_AND_PORT_OF_NODE_1,\n      ADDRESS_AND_PORT_OF_NODE_2,\n      ADDRESS_AND_PORT_OF_NODE_3,\n      ADDRESS_AND_PORT_OF_NODE_4\n    ]\n\n")),(0,o.kt)("p",null,"Each broker needs a unique node id. The ids should be in the range of\nzero and ",(0,o.kt)("inlineCode",{parentName:"p"},"clusterSize - 1"),". You need to replace the ",(0,o.kt)("inlineCode",{parentName:"p"},"NODE_ID")," placeholder with an\nappropriate value. Furthermore, the\nbrokers need an initial contact point to start their gossip\nconversation. Make sure that you use the address and\n",(0,o.kt)("strong",{parentName:"p"},"management port")," of another broker. You need to replace the\n",(0,o.kt)("inlineCode",{parentName:"p"},"ADDRESS_AND_PORT_OF_NODE_0")," placeholder."),(0,o.kt)("p",null,"To guarantee that a cluster can properly recover from network partitions,\nit is currently required that all nodes be specified as initial contact points. It is not necessary\nfor a broker to list itself as initial contact point, but it is safe to do so, and probably simpler\nto maintain."),(0,o.kt)("h2",{id:"partitions-bootstrapping"},"Partitions bootstrapping"),(0,o.kt)("p",null,"On bootstrap, each node will create a partition matrix."),(0,o.kt)("p",null,"This matrix depends on the partitions count, replication factor and\nthe cluster size. If you did the configuration right and\nused the same values for ",(0,o.kt)("inlineCode",{parentName:"p"},"partitionsCount"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"replicationFactor"),"\nand ",(0,o.kt)("inlineCode",{parentName:"p"},"clusterSize")," on each node, then all nodes will generate\nthe same partition matrix."),(0,o.kt)("p",null,"For the current example the matrix will look like the following:"),(0,o.kt)("table",null,(0,o.kt)("tr",null,(0,o.kt)("th",null),(0,o.kt)("th",null,"Node 0"),(0,o.kt)("th",null,"Node 1"),(0,o.kt)("th",null,"Node 2"),(0,o.kt)("th",null,"Node 3"),(0,o.kt)("th",null,"Node 4")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("b",null,"Partition 0")),(0,o.kt)("td",null,"Leader"),(0,o.kt)("td",null,"Follower"),(0,o.kt)("td",null,"Follower"),(0,o.kt)("td",null,"-"),(0,o.kt)("td",null,"-")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("b",null,"Partition 1")),(0,o.kt)("td",null,"-"),(0,o.kt)("td",null,"Leader"),(0,o.kt)("td",null,"Follower"),(0,o.kt)("td",null,"Follower"),(0,o.kt)("td",null,"-")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("b",null,"Partition 2")),(0,o.kt)("td",null,"-"),(0,o.kt)("td",null,"-"),(0,o.kt)("td",null,"Leader"),(0,o.kt)("td",null,"Follower"),(0,o.kt)("td",null,"Follower")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("b",null,"Partition 3")),(0,o.kt)("td",null,"Follower"),(0,o.kt)("td",null,"-"),(0,o.kt)("td",null,"-"),(0,o.kt)("td",null,"Leader"),(0,o.kt)("td",null,"Follower")),(0,o.kt)("tr",null,(0,o.kt)("td",null,(0,o.kt)("b",null,"Partition 4")),(0,o.kt)("td",null,"Follower"),(0,o.kt)("td",null,"Follower"),(0,o.kt)("td",null,"-"),(0,o.kt)("td",null,"-"),(0,o.kt)("td",null,"Leader"))),(0,o.kt)("p",null,"The matrix ensures that the partitions are well distributed\nbetween the different nodes. Furthermore, it guarantees that\neach node knows exactly, which partitions it has\nto bootstrap and for which it will become the leader at first (this\ncould change later, if the node needs to step down for example)."),(0,o.kt)("h2",{id:"keep-alive-intervals"},"Keep Alive Intervals"),(0,o.kt)("p",null,"It's possible to specify how often Zeebe clients should send keep alive pings. By default, the official Zeebe clients (Java and Go) send keep alive pings every 45 seconds. This interval can be configured through the clients' APIs and through the ",(0,o.kt)("inlineCode",{parentName:"p"},"ZEEBE_KEEP_ALIVE")," environment variable. When configuring the clients with the environment variable, the time interval must be expressed a positive amount of milliseconds (e.g., 45000)."),(0,o.kt)("p",null,"It's also possible to specify what is the minimum interval allowed by the gateway before it terminates the connection. By default, gateways terminate connections if they receive more than two pings with an interval less than 30 seconds. This minimum interval can be modified by editing the network section in the respective configuration file or by setting the ",(0,o.kt)("inlineCode",{parentName:"p"},"ZEEBE_GATEWAY_NETWORK_MINKEEPALIVEINTERVAL")," environment variable."))}c.isMDXComponent=!0},5026:function(e,t,n){"use strict";t.Z=n.p+"assets/images/example-setup-cluster-1d07984c6dc77e6268b1c82fd2ad4ab6.png"}}]);