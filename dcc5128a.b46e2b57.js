(window.webpackJsonp=window.webpackJsonp||[]).push([[688],{1626:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/create-workflow-ee0ffa1a268d6040d11f13dbf7738671.png"},1627:function(e,t,n){"use strict";n.r(t),t.default=n.p+"assets/images/create-workflow-with-result-a85699b136289b1303ffcd96a898943d.png"},755:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return i})),n.d(t,"rightToc",(function(){return c})),n.d(t,"default",(function(){return u}));var r=n(3),a=n(7),o=(n(0),n(874)),s={id:"workflow-instance-creation",title:"Workflow Instance Creation"},i={unversionedId:"product-manuals/zeebe/reference/workflow-instance-creation",id:"version-0.25/product-manuals/zeebe/reference/workflow-instance-creation",isDocsHomePage:!1,title:"Workflow Instance Creation",description:"Depending on the workflow definition, an instance of it can be created in the following ways.",source:"@site/versioned_docs/version-0.25/product-manuals/zeebe/reference/workflow-instance-creation.md",slug:"/product-manuals/zeebe/reference/workflow-instance-creation",permalink:"/docs/0.25/product-manuals/zeebe/reference/workflow-instance-creation",editUrl:"https://github.com/camunda-cloud/camunda-cloud-documentation/edit/master/versioned_docs/version-0.25/product-manuals/zeebe/reference/workflow-instance-creation.md",version:"0.25",sidebar:"version-0.25/Product Manuals",previous:{title:"Overview",permalink:"/docs/0.25/product-manuals/zeebe/reference/index"},next:{title:"Workflow Lifecycles",permalink:"/docs/0.25/product-manuals/zeebe/reference/workflow-lifecycles"}},c=[{value:"Create workflow instance command",id:"create-workflow-instance-command",children:[{value:"Create and Execute Asynchronously",id:"create-and-execute-asynchronously",children:[]},{value:"Create and Await Results",id:"create-and-await-results",children:[]}]},{value:"Workflow instance creation by events",id:"workflow-instance-creation-by-events",children:[{value:"By publishing a message",id:"by-publishing-a-message",children:[]},{value:"Using a timer",id:"using-a-timer",children:[]}]},{value:"Distribution over partitions",id:"distribution-over-partitions",children:[]}],l={rightToc:c};function u(e){var t=e.components,s=Object(a.a)(e,["components"]);return Object(o.b)("wrapper",Object(r.a)({},l,s,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Depending on the workflow definition, an instance of it can be created in the following ways."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"by a create workflow instance command"),Object(o.b)("li",{parentName:"ul"},"by an occured event (eg:- timer, message)")),Object(o.b)("h2",{id:"create-workflow-instance-command"},"Create workflow instance command"),Object(o.b)("p",null,"A workflow instance can be created by sending a command specifying the BPMN process id or the unique key of the workflow.\nThere are two commands to create a workflow instance."),Object(o.b)("h3",{id:"create-and-execute-asynchronously"},"Create and Execute Asynchronously"),Object(o.b)("p",null," A workflow that has a ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/0.25/product-manuals/zeebe/bpmn-workflows/none-events/none-events#none-start-events"}),"none start event")," can be started explicitly using the command ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/0.25/product-manuals/zeebe/reference/grpc#createworkflowinstance-rpc"}),"CreateWorkflowInstance"),".\nWhen the broker receives this commands, it creates a new workflow instance and immediately respond with the workflow instance id.\nThe execution of the workflow happens after the response is send."),Object(o.b)("p",null," ",Object(o.b)("img",{alt:"create-workflow",src:n(1626).default})),Object(o.b)("details",null,Object(o.b)("summary",null,"Code example"),Object(o.b)("p",null,"Create a workflow instance:",Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'zbctl create instance "order-process"\n')),Object(o.b)("p",null,"   Response:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'{\n "workflowKey": 2251799813685249,\n "bpmnProcessId": "order-process",\n "version": 1,\n "workflowInstanceKey": 2251799813686019\n}\n\n')))),Object(o.b)("h3",{id:"create-and-await-results"},"Create and Await Results"),Object(o.b)("p",null,"Typically, workflow creation and execution are decoupled.\nHowever, there are use-cases that need to collect the results of a workflow when it's execution is completed.\nThe ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/0.25/product-manuals/zeebe/reference/grpc#createworkflowinstancewithresult-rpc"}),"CreateWorkflowInstanceWithResult")," command allows you to \u201csynchronously\u201d execute workflows and receive the results via a set of variables.\nThe response is send when the workflow execution is completed."),Object(o.b)("p",null," ",Object(o.b)("img",{alt:"create-workflow",src:n(1627).default})),Object(o.b)("p",null,"Failure scenarios that are applicable to other commands are applicable to this command. Clients may not get a response in the following cases even if the workflow execution is completed successfully."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"Leader failover: When the broker that is processing this workflow crashed, another broker continues the processing. But it does not send the response because the request is registered on the other broker."),Object(o.b)("li",{parentName:"ul"},"Gateway failure: If the gateway to which the client is connected failed, broker cannot send the response to the client."),Object(o.b)("li",{parentName:"ul"},"gRPC timeout: If the gRPC deadlines are not configured for long request timeout, the connection may be closed before the workflow is completed.")),Object(o.b)("p",null,"This command is typically useful for short running workflows and workflows that collect information.\nIf the workflow mutates system state, or further operations rely on the workflow outcome response to the client, take care to consider and design your system for failure states and retries.\nNote that, when the client resend the command, it creates a new workflow instance."),Object(o.b)("details",null,Object(o.b)("summary",null,"Code example"),Object(o.b)("p",null,"Create a workflow instance and await results:",Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'zbctl create instance "order-process" --withResult --variables \'{"orderId": "1234"}\'\n')),Object(o.b)("p",null,"Response: (Note that the variables in the response depends on the workflow.)"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{}),'{\n  "workflowKey": 2251799813685249,\n  "bpmnProcessId": "order-process",\n  "version": 1,\n  "workflowInstanceKey": 2251799813686045,\n  "variables": "{\\"orderId\\":\\"1234\\"}"\n}\n')))),Object(o.b)("h2",{id:"workflow-instance-creation-by-events"},"Workflow instance creation by events"),Object(o.b)("p",null,"Workflow instances are also created implicitly via various start events. Zeebe supports message start events and timer start events."),Object(o.b)("h3",{id:"by-publishing-a-message"},"By publishing a message"),Object(o.b)("p",null,"A workflow with a ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/0.25/product-manuals/zeebe/bpmn-workflows/message-events/message-events#message-start-events"}),"message start event")," can be started by publishing a message with the  name that matches the message name of the start event.\nFor each new message a new instance is created."),Object(o.b)("h3",{id:"using-a-timer"},"Using a timer"),Object(o.b)("p",null,"A workflow can also have one or more ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/0.25/product-manuals/zeebe/bpmn-workflows/timer-events/timer-events#timer-start-events"}),"timer start events"),". An instance of the workflow is created when the associated timer is triggered."),Object(o.b)("h2",{id:"distribution-over-partitions"},"Distribution over partitions"),Object(o.b)("p",null," When a workflow instance is created in a partition, its state is stored and managed by the same partition until its execution is terminated. The partition in which it is created is determined by various factors."),Object(o.b)("ul",null,Object(o.b)("li",{parentName:"ul"},"When a user sends a command ",Object(o.b)("inlineCode",{parentName:"li"},"CreateWorkflowInstance")," or ",Object(o.b)("inlineCode",{parentName:"li"},"CreateWorkflowInstanceWithResult"),", gateway chooses a partition in a round-robin manner and forwards the requests to that partition. The workflow instance is created in that partition."),Object(o.b)("li",{parentName:"ul"},"When a user publishes a message, the message is forwarded to a partition based on the correlation key of the message. The workflow instance is created on the same partition where the message is published."),Object(o.b)("li",{parentName:"ul"},"Workflow instances created by timer start events are always created on partition 1.")))}u.isMDXComponent=!0},874:function(e,t,n){"use strict";n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return f}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),u=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},b=function(e){var t=u(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},p=a.a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),b=u(n),p=r,f=b["".concat(s,".").concat(p)]||b[p]||d[p]||o;return n?a.a.createElement(f,i(i({ref:t},l),{},{components:n})):a.a.createElement(f,i({ref:t},l))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,s[1]=i;for(var l=2;l<o;l++)s[l]=n[l];return a.a.createElement.apply(null,s)}return a.a.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);